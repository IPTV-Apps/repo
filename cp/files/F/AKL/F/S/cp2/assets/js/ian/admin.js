$(document).ready(function(){$("#fileupload").fileupload({acceptFileTypes:/(\.|\/)(zip)$/i,autoUpload:!1,progressall:function(e,t){t=parseInt(t.loaded/t.total*100,10);$("#progress .progress-bar").css("width",t+"%")}}),$("#fileupload").on("submit",function(e){e.preventDefault();e=new FormData($(this)[0]);$.ajax({url:$(this).attr("action"),type:"POST",data:e,cache:!1,contentType:!1,processData:!1,success:function(e){document.querySelectorAll(".toast").forEach(function(e){e.classList.add("show")}),e.includes("Module zip file extracted successfully.")?(console.log("Module zip file extracted successfully."),document.querySelector("#toast-1 .toast-body").innerHTML="Success! Module added Successfully."):(console.error("Failed to extract Module zip file."),document.querySelector("#toast-1 .toast-body").innerHTML="There was a problem adding the Module.")},complete:function(e,t){location.reload()},error:function(e,t,o){console.error("Error during upload:",o)},xhr:function(){var e=$.ajaxSettings.xhr();return e.upload&&e.upload.addEventListener("progress",function(e){e.lengthComputable&&(e=e.loaded/e.total*100,$("#progress .progress-bar").css("width",e+"%"))},!1),e}})}),$("#fileupload").on("fileuploaddone",function(e,t){$("#progress .progress-bar").css("width","0%"),location.reload()}),$("#fileupload").on("fileuploadchange",function(e,t){$("#fileupload .empty-row").hide()}),$("#fileupload").on("fileuploadfail",function(e,t){"abort"===t.errorThrown&&1==$("#fileupload .files tr").not(".empty-row").length&&$("#fileupload .empty-row").show()})}),$("#datatableVisits").DataTable({dom:"<'row mb-3'<'col-sm-4'l><'col-sm-8 text-end'<'d-flex justify-content-end'fB>>>t<'d-flex align-items-center'<'me-auto'i><'mb-0'p>>",lengthMenu:[10,20,30,40,50],responsive:!0,buttons:[{extend:"csv",className:"btn-sm btn-outline-theme"}]}),$(document).ready(function(){var r;$(document).on("click",".btn-panel-edit",function(e){e.preventDefault(),r=$(this).data("panel"),$("#panelSettingsModal .modal-body").empty(),$("#panelSettingsModal").modal("show");e=document.querySelector('meta[name="csrf-token"]').getAttribute("content");$.ajax({url:"includes/get_admin.php",data:{panelName:r,csrf_token:e},success:function(e){var s;console.log("Received files:",e),e&&"object"==typeof e&&0<Object.keys(e).length?(s={},$.each(e,function(e,n){n.trim().endsWith(".json")&&$.getJSON("panel/"+r+"/includes/db/"+n).done(function(e){var a,t=n.split("/").pop(),o=t.replace(/[^_]+_admin_(.+)\.json/,"$1");s[o]={fileName:t,data:e},t=o,(o=e)&&"object"==typeof o?(a="",a+='<h4 class="card-title mb-3">'+t.replace(/_/g," ").toUpperCase()+"</h4>",$.each(o,function(e,t){var o=e.replace(/_/g," ");a=(a=(a+='<div class="card"><div class="card-body d-flex align-items-center">')+'<span class="me-auto">'+o+'</span><div class="form-check form-switch">')+'<input class="form-check-input" type="checkbox" id="'+e+'"'+("true"===t?" checked":"")+'></div></div><div class="card-arrow"><div class="card-arrow-top-left"></div><div class="card-arrow-top-right"></div><div class="card-arrow-bottom-left"></div><div class="card-arrow-bottom-right"></div></div></div>'}),a+='<div class="mb-3"></div><div class="d-flex justify-content-end"></div>',$("#panelSettingsModal .modal-body").append(a)):console.error("Invalid data format:",o)}).fail(function(e,t,o){console.error("Error fetching JSON:",o)})}),$("#panelSettingsModal .btn-primary").data("settingsWithFiles",s)):(console.log("No JSON files found."),$("#panelSettingsModal .modal-body").append('<h4 class="card-title mb-3">No Settings Found</h4>'))},error:function(e,t,o){console.error("Error fetching files:",o)}})}),$(document).on("click","#panelSettingsModal .btn-primary",function(){var o={},e=$(this).data("settingsWithFiles"),t=document.querySelector('meta[name="csrf-token"]').getAttribute("content");$("#panelSettingsModal .form-check-input").each(function(){var e=$(this).attr("id"),t=$(this).is(":checked");o[e]=t}),$.ajax({url:"includes/update_admin.php",method:"POST",data:{panelName:r,updatedData:o,settingsWithFiles:e,csrf_token:t},success:function(e){$("#panelSettingsModal").modal("hide"),location.reload()},error:function(e,t,o){console.error("Error updating data:",o)}})}),$(document).on("click",".btn-sidebar-settings-edit",function(){r=$(this).data("sidebar"),$.getJSON("panel/"+r+"/panel_info.json").done(function(e){e=e,$("#sidebarSettingsModal .modal-body").empty(),$("#sidebarSettingsModal").modal("show"),e.pages&&0<e.pages.length?$.each(e.pages,function(e,t){var o='<div class="card">',o=(o=(o=(o=(o=(o=(o=(o+='<div class="card-body d-flex align-items-center">')+('<span class="me-auto">'+t.title+"</span>")+'<div class="form-check form-switch">')+('<input class="form-check-input" type="checkbox" id="page-'+e+'"')+(t.enabled?" checked":""))+">"+"</div>")+"</div>"+'<div class="card-arrow">')+'<div class="card-arrow-top-left"></div>'+'<div class="card-arrow-top-right"></div>')+'<div class="card-arrow-bottom-left"></div>'+'<div class="card-arrow-bottom-right"></div>')+"</div>"+"</div>";$("#sidebarSettingsModal .modal-body").append(o)}):$("#sidebarSettingsModal .modal-body").append('<h4 class="card-title mb-3">No Menu Pages Found</h4>')}).fail(function(e,t,o){console.error("Error fetching panel_info.json:",o)})}),$(document).on("click","#sidebarSettingsModal .btn-primary",function(){var a=[];$("#sidebarSettingsModal .form-check-input").each(function(e,t){var o={title:$(this).siblings(".form-check-label").text(),enabled:$(this).is(":checked")};a.push(o)}),$.getJSON("panel/"+r+"/panel_info.json").done(function(e){e.pages.forEach(function(e,t){e.enabled=a[t].enabled});var e=JSON.stringify(e),t=document.querySelector('meta[name="csrf-token"]').getAttribute("content");$.ajax({url:"includes/update_panel_info.php",method:"POST",data:{panelName:r,panelInfo:e,csrf_token:t},success:function(e){console.log("Panel info updated successfully:",e),$("#sidebarSettingsModal").modal("hide"),location.reload()},error:function(e,t,o){console.error("Error updating panel_info.json:",o)}})}).fail(function(e,t,o){console.error("Error fetching panel_info.json:",o)})})});var dates=Object.keys(data_users).slice(-14),users=dates.map(e=>data_users[e].total_users),topPagesSeries=[];for(const Ca of dates){const Da=data_users[Ca].top_pages.slice(0,3);for(const Ea of Da){const Fa=topPagesSeries.findIndex(e=>e.name===Ea.page);-1!==Fa?topPagesSeries[Fa].data.push(Ea.visits):topPagesSeries.push({name:Ea.page,type:"bar",data:[Ea.visits]})}}var apexMixedChartOptions={chart:{height:350,type:"line",stacked:!0,foreColor:"#ffffff"},dataLabels:{enabled:!1},series:[{name:"Visitors",type:"line",color:"#ffffff",data:users},...topPagesSeries],colors:["#ffffff"],theme:{monochrome:{enabled:!0,color:app.color.theme,shadeTo:"dark",shadeIntensity:.65}},xaxis:{categories:dates,axisBorder:{show:!0,color:"#ffffff",height:1,width:"100%",offsetX:0,offsetY:-1},axisTicks:{show:!0,color:"#ffffff",height:6,offsetX:0,offsetY:0},labels:{style:{colors:"#ffffff"}}},yaxis:{labels:{formatter:function(e){return e},style:{colors:"#ffffff"}},title:{text:"Visitor Count",style:{color:"#ffffff"}}},tooltip:{fixed:{enabled:!0,position:"topLeft",offsetY:30,offsetX:60},style:{color:"#ffffff"}},legend:{horizontalAlign:"left",offsetX:40,labels:{colors:"#ffffff"}}},apexMixedChart=new ApexCharts(document.querySelector("#apexMixedChart"),apexMixedChartOptions);function deleteStorefront(e){var t=document.querySelector('meta[name="csrf-token"]').getAttribute("content");confirm("Are you sure you want to delete this storefront?")&&$.ajax({type:"post",url:"./includes/post_admin.php",data:{csrf_token:t,delete_storefront:1,id:e},success:function(){location.reload()}})}function editStorefront(e,t){$("#store_name").val(e),$("#api_url").val(t)}apexMixedChart.render(),$(function(){$("#post_storefront").on("submit",function(e){e.preventDefault();e=new FormData(this);e.append("post_storefront","1"),$.ajax({type:"post",url:"./includes/post_admin.php",data:e,processData:!1,contentType:!1,success:function(){location.reload()}})})});